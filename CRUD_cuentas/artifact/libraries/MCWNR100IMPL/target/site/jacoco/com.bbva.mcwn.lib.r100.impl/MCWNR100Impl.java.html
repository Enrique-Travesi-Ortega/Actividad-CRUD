<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MCWNR100Impl.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">MCWNR100IMPL</a> &gt; <a href="index.source.html" class="el_package">com.bbva.mcwn.lib.r100.impl</a> &gt; <span class="el_source">MCWNR100Impl.java</span></div><h1>MCWNR100Impl.java</h1><pre class="source lang-java linenums">package com.bbva.mcwn.lib.r100.impl;

import java.util.List;
import java.util.Objects;

import org.apache.commons.lang3.StringUtils;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import com.bbva.elara.domain.transaction.RequestHeaderParamsName;
import com.bbva.mcwn.dto.holder.AccountDTO;
import com.bbva.mcwn.dto.holder.HolderDTO;

/**
 * The MCWNR100Impl class...
 */
<span class="fc" id="L17">public class MCWNR100Impl extends MCWNR100Abstract {</span>

<span class="fc" id="L19">	private static final Logger LOGGER = LoggerFactory.getLogger(MCWNR100Impl.class);</span>
	private static final String MCWN01415034 = &quot;MCWN01415034&quot;;

	@Override
	public HolderDTO executeCreateAccountAndOwner(HolderDTO holderIn) {
<span class="nc" id="L24">		String clientType = </span>
<span class="nc" id="L25">			(String) this.getRequestHeader().getHeaderParameter(RequestHeaderParamsName.CLIENTDOCUMENT);</span>
		
<span class="nc bnc" id="L27" title="All 2 branches missed.">		if(!validateClientType(holderIn, clientType))</span>
<span class="nc" id="L28">			return null;</span>
		
<span class="nc bnc" id="L30" title="All 2 branches missed.">		if (!validParameters(holderIn))</span>
<span class="nc" id="L31">			return null;</span>
		
<span class="nc" id="L33">		String max_balance_string = applicationConfigurationService.getProperty(&quot;MAX_BALANCE&quot;);</span>
<span class="nc" id="L34">		Double max_balance = Double.parseDouble(max_balance_string);</span>
		
<span class="nc bnc" id="L36" title="All 2 branches missed.">		if (max_balance &lt; holderIn.getAccount().getBalance()) {</span>
<span class="nc" id="L37">			this.addAdvice(&quot;MCWN01415048&quot;);</span>
		}
<span class="nc" id="L39">		long randomNip = (long) (1000 + Math.random() * 9000);</span>
<span class="nc" id="L40">		holderIn.getAccount().setAccountNip(randomNip);</span>
		
<span class="nc bnc" id="L42" title="All 2 branches missed.">		if (checkAccountExists(holderIn.getAccount().getAccountNumber(), holderIn.getAccount().getAccountCard()))</span>
<span class="nc" id="L43">			return null;</span>
		
<span class="nc" id="L45">		HolderDTO newAccount = mcwnR101.executeCreateAccountAndOwner(holderIn);</span>
<span class="nc bnc" id="L46" title="All 2 branches missed.">		if (newAccount == null) {</span>
<span class="nc" id="L47">			getAdvice();</span>
<span class="nc" id="L48">			return null;</span>
		}
		
<span class="nc bnc" id="L51" title="All 2 branches missed.">		if (clientType.equals(&quot;0&quot;))</span>
<span class="nc" id="L52">			newAccount.setHolderType(&quot;FISICO&quot;);</span>
<span class="nc bnc" id="L53" title="All 2 branches missed.">		else if (clientType.equals(&quot;1&quot;))</span>
<span class="nc" id="L54">			newAccount.setHolderType(&quot;MORAL&quot;);</span>
		
<span class="nc" id="L56">		return newAccount;</span>
	}

	@Override
public HolderDTO executeRetrieveAccountHolderTransaction(AccountDTO accountIn) {
		
<span class="nc" id="L62">		LOGGER.info(&quot;MCWNR100IMPL inicio ejecución de executeRetrieveAccountHolderTransaction&quot;);</span>
		
				
		//Objeto vacío
<span class="nc" id="L66">		HolderDTO empty = new HolderDTO();</span>
		
		//Validaciones datos obligatorios (Nº de cuenta y el NIP)
<span class="nc bnc" id="L69" title="All 6 branches missed.">		if (accountIn == null || accountIn.getAccountNumber() == null || accountIn.getAccountNip() == null) {</span>
<span class="nc" id="L70">		      this.addAdvice(&quot;MCWN01415034&quot;);</span>
<span class="nc" id="L71">		      return empty;</span>
		    }
		//Validaciones de longitud (Nº de cuenta y el NIP)
<span class="nc" id="L74">		String acctStr = String.valueOf(accountIn.getAccountNumber());</span>
<span class="nc bnc" id="L75" title="All 2 branches missed.">	    if (acctStr.length() != 10) {</span>
<span class="nc" id="L76">	      this.addAdvice(&quot;MCWN01415029&quot;);</span>
<span class="nc" id="L77">	      return empty;</span>
	    }
	    
<span class="nc" id="L80">	    long nip = accountIn.getAccountNip();</span>
<span class="nc" id="L81">	    String nipStr = String.valueOf(nip);</span>
<span class="nc bnc" id="L82" title="All 2 branches missed.">	    if (nipStr.length() != 4) {</span>
<span class="nc" id="L83">	      this.addAdvice(&quot;MCWN01415029&quot;);</span>
<span class="nc" id="L84">	      return empty;</span>
	    }	
	    
	    //Recibimos una Objeto con la cuenta y lo consultamos con la db
<span class="nc" id="L88">	 		HolderDTO data = mcwnR101.executeRetrieveAccountHolderTransaction(accountIn.getAccountNumber());</span>
	 		
<span class="nc bnc" id="L90" title="All 2 branches missed.">	 		if (data == null) {</span>
<span class="nc" id="L91">	 		      this.addAdvice(&quot;MCWN01415035&quot;);</span>
<span class="nc" id="L92">	 		      return null;</span>
	 		    }		
		
		//Validar estado de la cuenta (Boolean: False = inactiva y True: activa)
<span class="nc" id="L96">		Boolean status = data.getAccount().getStatus();</span>
<span class="nc" id="L97">		Boolean isActive = Boolean.TRUE.equals(status);</span>
		
<span class="nc bnc" id="L99" title="All 2 branches missed.">		if (!isActive) {</span>
<span class="nc" id="L100">		    this.addAdvice(&quot;MCWN01415044&quot;);</span>
<span class="nc" id="L101">		    return empty;</span>
		}			
		
		//Validación de existencia del AccountNip
		
<span class="nc bnc" id="L106" title="All 2 branches missed.">		Long expectedNip = (data.getAccount() != null) ? data.getAccount().getAccountNip() : null;</span>
<span class="nc bnc" id="L107" title="All 4 branches missed.">	    if (expectedNip == null || !expectedNip.equals(accountIn.getAccountNip())) {</span>
<span class="nc" id="L108">	      this.addAdvice(&quot;MCWN01415036&quot;);</span>
<span class="nc" id="L109">	      return empty;</span>
	    }
	    
	        
<span class="nc" id="L113">	    LOGGER.info(&quot;MCWNR100IMPL fin ejecución de executeRetrieveAccountHolderTransaction&quot;);</span>
	    
<span class="nc" id="L115">	    return data;</span>
 
	  }

	@Override
	public List&lt;HolderDTO&gt; executeGetAllAccounts() {
<span class="nc" id="L121">		LOGGER.info(&quot;MCWNR100Impl: Ejecutar metodo de la lista executeGetAllAccounts&quot;);</span>
<span class="nc" id="L122">   	 	return mcwnR101.executeGetAllAccounts();</span>
	}

	@Override
	public HolderDTO executeUpdateAccountHolderInfoTransaction(HolderDTO holderIn) {
		
<span class="nc" id="L128">		LOGGER.info(&quot;Entrando en el metodo de la 100&quot;);</span>
		
<span class="nc bnc" id="L130" title="All 2 branches missed.">		if (holderIn.getAccount() == null) {</span>
<span class="nc" id="L131">		      this.addAdvice(MCWN01415034, &quot;account&quot;);</span>
<span class="nc" id="L132">		      return null;</span>
		    }
		
<span class="nc bnc" id="L135" title="All 2 branches missed.">		if (holderIn.getAccount().getAccountNumber() == null) {</span>
<span class="nc" id="L136">		      this.addAdvice(MCWN01415034, &quot;accountNumber&quot;);</span>
<span class="nc" id="L137">		      return null;</span>
		    }
		
<span class="nc" id="L140">		String clientType = </span>
<span class="nc" id="L141">				(String) this.getRequestHeader().getHeaderParameter(RequestHeaderParamsName.CLIENTDOCUMENT);</span>
		
<span class="nc" id="L143">		LOGGER.info(&quot;Recupero header de client document para establecer client type&quot;);</span>
		
<span class="nc bnc" id="L145" title="All 2 branches missed.">		if(!validateClientType(holderIn, clientType))</span>
<span class="nc" id="L146">			return null;</span>
		
<span class="nc" id="L148">		LOGGER.info(&quot;Hemos hecho las validaciones del clientType&quot;);</span>
		
<span class="nc" id="L150">		HolderDTO oldHolder = mcwnR101.executeRetrieveAccountHolderTransaction(holderIn.getAccount().getAccountNumber());</span>
		
<span class="nc" id="L152">		LOGGER.info(&quot;Obtengo el holder antiguo que quiero modificar&quot;);</span>
		
<span class="nc bnc" id="L154" title="All 2 branches missed.">		if (validateUpdateCommonParams(holderIn, oldHolder) == null)</span>
<span class="nc" id="L155">			return null;</span>
<span class="nc bnc" id="L156" title="All 2 branches missed.">		if (clientType.equals(&quot;0&quot;)) {</span>
<span class="nc bnc" id="L157" title="All 2 branches missed.">			if(validateUpdatePhysicPerson(holderIn, oldHolder) == null)</span>
<span class="nc" id="L158">				return null;</span>
		}else {
<span class="nc bnc" id="L160" title="All 2 branches missed.">			if(validateUpdateMoralPerson(holderIn, oldHolder) == null)</span>
<span class="nc" id="L161">				return null;</span>
		}
		
<span class="nc" id="L164">		LOGGER.info(&quot;Hemos hecho las validaciones principales&quot;);</span>
		
<span class="nc bnc" id="L166" title="All 2 branches missed.">		if(!oldHolder.getAccount().getAccountCard().equals(holderIn.getAccount().getAccountCard())) {</span>
<span class="nc" id="L167">			LOGGER.info(&quot;La credit cards han cambiado por lo que voy a mirar si ya existe la nueva en la BBDD&quot;);</span>
			
<span class="nc" id="L169">			Integer statusWithAccountCard = </span>
<span class="nc" id="L170">					mcwnR101.checkStatusWithAccountCard(holderIn.getAccount().getAccountCard());</span>
			
<span class="nc bnc" id="L172" title="All 4 branches missed.">			if (Objects.equals(statusWithAccountCard, 1) || Objects.equals(statusWithAccountCard, 0)) {</span>
<span class="nc" id="L173">				this.addAdvice(&quot;MCWN01415039&quot;);</span>
<span class="nc" id="L174">				return null;</span>
			}
		}
		
<span class="nc" id="L178">		LOGGER.info(&quot;He llegado a al metodo donde preparo holder para update&quot;);</span>
		
<span class="nc" id="L180">		HolderDTO updateHolder = prepareHolderForUpdate(oldHolder, holderIn);</span>
		
<span class="nc" id="L182">		LOGGER.info(&quot;He salido del metodo donde preparo holder para update&quot;);</span>
		
<span class="nc" id="L184">		HolderDTO finalHolder = mcwnR101.executeUpdateAccountHolderInfoTransaction(updateHolder);</span>
<span class="nc" id="L185">		getAdvice();</span>
		
<span class="nc bnc" id="L187" title="All 2 branches missed.">		if (clientType.equals(&quot;0&quot;))</span>
<span class="nc" id="L188">			finalHolder.setHolderType(&quot;FISICO&quot;);</span>
<span class="nc bnc" id="L189" title="All 2 branches missed.">		else if (clientType.equals(&quot;1&quot;))</span>
<span class="nc" id="L190">			finalHolder.setHolderType(&quot;MORAL&quot;);</span>
		
<span class="nc" id="L192">		LOGGER.info(&quot;VOLVIMOOOOS&quot;);</span>
		
		
<span class="nc" id="L195">		return finalHolder;</span>
	}

	@Override
	public Boolean executeManageAccountStatusTransaction(AccountDTO accountIn) {
		 
<span class="nc" id="L201">	    LOGGER.info(&quot;MCWNR100Impl: executeManageAccountStatusTransaction - start&quot;);</span>
 
<span class="nc bnc" id="L203" title="All 4 branches missed.">	    if (accountIn == null || accountIn.getAccountNumber() == null) {</span>
<span class="nc" id="L204">	        LOGGER.info(&quot;MCWNR100Impl: accountNumber is null&quot;);</span>
<span class="nc" id="L205">	        this.addAdvice(&quot;MCWN01415034&quot;, &quot;accountNumber is mandatory&quot;);</span>
<span class="nc" id="L206">	        return false;</span>
	    }
 
<span class="nc" id="L209">	    LOGGER.info(&quot;MCWNR100Impl: accountNumber validation OK&quot;);</span>
 
<span class="nc" id="L211">	    Long acc = accountIn.getAccountNumber();</span>
	    
<span class="nc bnc" id="L213" title="All 2 branches missed.">	    if (acc &lt; 10) {</span>
<span class="nc" id="L214">	        this.addAdvice(&quot;MCWN01415034&quot;, &quot;accountNumber must have 10 digits&quot;);</span>
<span class="nc" id="L215">	        return false;</span>
	    }
 
<span class="nc" id="L218">	    Boolean exists = mcwnR101.executeGetAccountExists(accountIn.getAccountNumber());</span>
	    
<span class="nc" id="L220">	    LOGGER.info(&quot;MCWNR100Impl: exists={}&quot;, exists);</span>
 
<span class="nc bnc" id="L222" title="All 2 branches missed.">	    if (Boolean.FALSE.equals(exists)) {</span>
<span class="nc" id="L223">	        this.addAdvice(&quot;MCWN01415035&quot;, &quot;The account does not exist&quot;);</span>
<span class="nc" id="L224">	        return false;</span>
	    }
 
<span class="nc" id="L227">	    Boolean isActive = mcwnR101.executeGetAccountIsActive(accountIn.getAccountNumber());</span>
<span class="nc" id="L228">	    LOGGER.info(&quot;MCWNR100Impl: isActive={}&quot;, isActive);</span>
 
<span class="nc bnc" id="L230" title="All 2 branches missed.">	    if (Boolean.FALSE.equals(isActive)) {</span>
<span class="nc" id="L231">	        this.addAdvice(&quot;MCWN01415037&quot;, &quot;The account is already inactive&quot;);</span>
<span class="nc" id="L232">	        return false;</span>
	    }
 
<span class="nc" id="L235">	    Boolean updated = mcwnR101.executeUpdateAccountStatus(accountIn.getAccountNumber(), 0);</span>
<span class="nc" id="L236">	    LOGGER.info(&quot;MCWNR100Impl: updated={}&quot;, updated);</span>
 
<span class="nc bnc" id="L238" title="All 2 branches missed.">	    if (!updated) {</span>
<span class="nc" id="L239">	        this.addAdvice(&quot;MCWN01415041&quot;, &quot;Could not update the status&quot;);</span>
<span class="nc" id="L240">	        return false;</span>
	    }
 
<span class="nc" id="L243">	    LOGGER.info(&quot;MCWNR100Impl: executeManageAccountStatusTransaction - complete&quot;);</span>
<span class="nc" id="L244">	    return true;</span>
	}

	private Boolean validParameters(HolderDTO holder) {
		
<span class="nc" id="L249">		LOGGER.info(&quot;MCWNR100Impl: Validating parameters&quot;);</span>
		
<span class="nc bnc" id="L251" title="All 2 branches missed.">		if (StringUtils.isBlank(holder.getName())) {</span>
<span class="nc" id="L252">		      this.addAdvice(MCWN01415034, &quot;name&quot;);</span>
<span class="nc" id="L253">		      return false;</span>
		    }
		
<span class="nc bnc" id="L256" title="All 2 branches missed.">		if (StringUtils.isBlank(holder.getRfc())) {</span>
<span class="nc" id="L257">		      this.addAdvice(MCWN01415034, &quot;rfc&quot;);</span>
<span class="nc" id="L258">		      return false;</span>
		    }
		
<span class="nc bnc" id="L261" title="All 2 branches missed.">		if (holder.getAccount() == null) {</span>
<span class="nc" id="L262">		      this.addAdvice(MCWN01415034, &quot;account&quot;);</span>
<span class="nc" id="L263">		      return false;</span>
		    }
		
<span class="nc bnc" id="L266" title="All 2 branches missed.">		if (holder.getAccount().getAccountCard() == null) {</span>
<span class="nc" id="L267">		      this.addAdvice(MCWN01415034, &quot;accountCard&quot;);</span>
<span class="nc" id="L268">		      return false;</span>
		    }
		
<span class="nc bnc" id="L271" title="All 2 branches missed.">		if (holder.getAccount().getAccountNumber() == null) {</span>
<span class="nc" id="L272">		      this.addAdvice(MCWN01415034, &quot;accountNumber&quot;);</span>
<span class="nc" id="L273">		      return false;</span>
		    }
<span class="nc bnc" id="L275" title="All 2 branches missed.">		if (holder.getAccount().getBalance() == null) {</span>
<span class="nc" id="L276">		      this.addAdvice(MCWN01415034, &quot;balance&quot;);</span>
<span class="nc" id="L277">		      return false;</span>
		    }
<span class="nc bnc" id="L279" title="All 2 branches missed.">		if (holder.getHolderType().equals(&quot;FISICO&quot;)) {</span>
			
<span class="nc bnc" id="L281" title="All 2 branches missed.">			 if (StringUtils.isBlank(holder.getLastName())) {</span>
<span class="nc" id="L282">			      this.addAdvice(MCWN01415034, &quot;lastName&quot;);</span>
<span class="nc" id="L283">			      return false;</span>
			    }

<span class="nc bnc" id="L286" title="All 2 branches missed.">			    if (StringUtils.isBlank(holder.getCurp())) {</span>
<span class="nc" id="L287">			      this.addAdvice(MCWN01415034, &quot;curp&quot;);</span>
<span class="nc" id="L288">			      return false;</span>
			    }

<span class="nc bnc" id="L291" title="All 2 branches missed.">			    if (holder.getAge() == null) {</span>
<span class="nc" id="L292">			      this.addAdvice(MCWN01415034, &quot;age&quot;);</span>
<span class="nc" id="L293">			      return false;</span>
			    }

<span class="nc bnc" id="L296" title="All 2 branches missed.">			    if (holder.getCurp().length() != 18) {</span>
<span class="nc" id="L297">			      this.addAdvice(&quot;MCWN01415031&quot;);</span>
<span class="nc" id="L298">			      return false;</span>
			    }

<span class="nc bnc" id="L301" title="All 2 branches missed.">			    if (holder.getRfc().length() != 13) {</span>
<span class="nc" id="L302">			      this.addAdvice(&quot;MCWN01415032&quot;);</span>
<span class="nc" id="L303">			      return false;</span>
			    }
		}
		
<span class="nc bnc" id="L307" title="All 2 branches missed.">		if (holder.getHolderType().equals(&quot;MORAL&quot;)) {</span>
<span class="nc bnc" id="L308" title="All 2 branches missed.">			if (holder.getRfc().length() != 12) {</span>
<span class="nc" id="L309">			      this.addAdvice(&quot;MCWN01415033&quot;);</span>
<span class="nc" id="L310">			      return false;</span>
			    }
		}
		
<span class="nc" id="L314">		return true;</span>
	}
	
	private Boolean checkAccountExists(Long accountNumber, Long accountCard) {
		
<span class="nc" id="L319">	Integer statusWithAccountNumber = </span>
<span class="nc" id="L320">			mcwnR101.checkStatusWithAccountNumber(accountNumber);</span>

<span class="nc bnc" id="L322" title="All 2 branches missed.">	if (Objects.equals(statusWithAccountNumber, 1)) {</span>
<span class="nc" id="L323">		this.addAdvice(&quot;MCWN01415038&quot;);</span>
<span class="nc" id="L324">		return true;</span>
	}
<span class="nc bnc" id="L326" title="All 2 branches missed.">	if(Objects.equals(statusWithAccountNumber, 0)) {</span>
<span class="nc" id="L327">		this.addAdvice(&quot;MCWN01415042&quot;);</span>
<span class="nc" id="L328">		return true;</span>
	}
	
<span class="nc" id="L331">	Integer statusWithAccountCard = </span>
<span class="nc" id="L332">			mcwnR101.checkStatusWithAccountCard(accountCard);</span>
	
<span class="nc bnc" id="L334" title="All 2 branches missed.">	if (Objects.equals(statusWithAccountCard, 1)) {</span>
<span class="nc" id="L335">		this.addAdvice(&quot;MCWN01415039&quot;);</span>
<span class="nc" id="L336">		return true;</span>
	}
<span class="nc bnc" id="L338" title="All 2 branches missed.">	if(Objects.equals(statusWithAccountCard, 0)) {</span>
<span class="nc" id="L339">		this.addAdvice(&quot;MCWN01415043&quot;);</span>
<span class="nc" id="L340">		return true;</span>
	}
	
<span class="nc" id="L343">	return false;</span>
	}
	
	private Boolean validateClientType(HolderDTO holder, String clientType) {
			
<span class="nc bnc" id="L348" title="All 2 branches missed.">		if (clientType.equals(&quot;0&quot;))</span>
<span class="nc" id="L349">			holder.setHolderType(&quot;0&quot;);</span>
<span class="nc bnc" id="L350" title="All 2 branches missed.">		else if (clientType.equals(&quot;1&quot;))</span>
<span class="nc" id="L351">			holder.setHolderType(&quot;1&quot;);</span>
		else {
<span class="nc" id="L353">			this.addAdvice(&quot;MCWN01415030&quot;);</span>
<span class="nc" id="L354">			return false;</span>
		}
<span class="nc" id="L356">		return true;</span>
	}
	
	private HolderDTO validateUpdateCommonParams(HolderDTO newHolder, HolderDTO oldHolder) {
		
<span class="nc bnc" id="L361" title="All 4 branches missed.">		if (StringUtils.isBlank(newHolder.getName()) &amp;&amp; StringUtils.isBlank(oldHolder.getName())){</span>
<span class="nc" id="L362">		      this.addAdvice(MCWN01415034, &quot;name&quot;);</span>
<span class="nc" id="L363">		      return null;</span>
		}
		
<span class="nc bnc" id="L366" title="All 4 branches missed.">		if (StringUtils.isBlank(newHolder.getRfc()) &amp;&amp; StringUtils.isBlank(oldHolder.getRfc())){</span>
<span class="nc" id="L367">		      this.addAdvice(MCWN01415034, &quot;rfc&quot;);</span>
<span class="nc" id="L368">		      return null;</span>
		}
		
<span class="nc bnc" id="L371" title="All 4 branches missed.">		if (oldHolder.getAccount() == null &amp;&amp; newHolder.getAccount() == null) {</span>
<span class="nc" id="L372">		      this.addAdvice(MCWN01415034, &quot;account&quot;);</span>
<span class="nc" id="L373">		      return null;</span>
		    }
		
<span class="nc bnc" id="L376" title="All 4 branches missed.">		if (oldHolder.getAccount().getAccountCard() == null &amp;&amp; newHolder.getAccount().getAccountCard() == null) {</span>
<span class="nc" id="L377">		      this.addAdvice(MCWN01415034, &quot;accountCard&quot;);</span>
<span class="nc" id="L378">		      return null;</span>
		    }
		
<span class="nc bnc" id="L381" title="All 4 branches missed.">		if (oldHolder.getAccount().getAccountNumber() == null &amp;&amp; newHolder.getAccount().getAccountNumber() == null) {</span>
<span class="nc" id="L382">		      this.addAdvice(MCWN01415034, &quot;accountNumber&quot;);</span>
<span class="nc" id="L383">		      return null;</span>
		    }
<span class="nc bnc" id="L385" title="All 4 branches missed.">		if (oldHolder.getAccount().getBalance() == null &amp;&amp; newHolder.getAccount().getBalance() == null) {</span>
<span class="nc" id="L386">		      this.addAdvice(MCWN01415034, &quot;balance&quot;);</span>
<span class="nc" id="L387">		      return null;</span>
		    }
		
<span class="nc" id="L390">		return newHolder;</span>
	}
	
	
	
	private HolderDTO validateUpdatePhysicPerson(HolderDTO newHolder, HolderDTO oldHolder) {
		
<span class="nc bnc" id="L397" title="All 4 branches missed.">		if (StringUtils.isBlank(newHolder.getLastName()) &amp;&amp; StringUtils.isBlank(oldHolder.getLastName())){</span>
<span class="nc" id="L398">		      this.addAdvice(MCWN01415034, &quot;lastName&quot;);</span>
<span class="nc" id="L399">		      return null;</span>
		}
		
<span class="nc bnc" id="L402" title="All 4 branches missed.">		if (StringUtils.isBlank(newHolder.getCurp()) &amp;&amp; StringUtils.isBlank(oldHolder.getCurp())){</span>
<span class="nc" id="L403">		      this.addAdvice(MCWN01415034, &quot;curp&quot;);</span>
<span class="nc" id="L404">		      return null;</span>
		}
		
<span class="nc bnc" id="L407" title="All 4 branches missed.">		if (oldHolder.getAge() == null &amp;&amp; newHolder.getAge() == null) {</span>
<span class="nc" id="L408">		      this.addAdvice(MCWN01415034, &quot;age&quot;);</span>
<span class="nc" id="L409">		      return null;</span>
		}
		
<span class="nc bnc" id="L412" title="All 2 branches missed.">		if (newHolder.getCurp().length() != 18) {</span>
<span class="nc" id="L413">		      this.addAdvice(&quot;MCWN01415031&quot;);</span>
<span class="nc" id="L414">		      return null;</span>
		}

<span class="nc bnc" id="L417" title="All 2 branches missed.">	    if (newHolder.getRfc().length() != 13) {</span>
<span class="nc" id="L418">		      this.addAdvice(&quot;MCWN01415032&quot;);</span>
<span class="nc" id="L419">		      return null;</span>
	    }
		
		
<span class="nc" id="L423">		return newHolder;</span>
	}
	
	private HolderDTO validateUpdateMoralPerson(HolderDTO newHolder, HolderDTO oldHolder) {
		
<span class="nc" id="L428">		Boolean advice = false;</span>
		
<span class="nc bnc" id="L430" title="All 2 branches missed.">		if (!newHolder.getLastName().isBlank()) {</span>
<span class="nc" id="L431">			this.addAdvice(&quot;MCWN01415045&quot;);</span>
<span class="nc" id="L432">			newHolder.setLastName(&quot;NO_APLICA&quot;);</span>
<span class="nc" id="L433">			advice = true;</span>
			
		}
<span class="nc bnc" id="L436" title="All 2 branches missed.">		if (!newHolder.getCurp().isBlank()) {</span>
<span class="nc" id="L437">			this.addAdvice(&quot;MCWN01415045&quot;);</span>
<span class="nc" id="L438">			newHolder.setCurp(&quot;NO_APLICA&quot;);</span>
<span class="nc" id="L439">			advice = true;</span>
		}
<span class="nc bnc" id="L441" title="All 2 branches missed.">		if (newHolder.getAge() != null) {</span>
<span class="nc" id="L442">			this.addAdvice(&quot;MCWN01415045&quot;);</span>
<span class="nc" id="L443">			newHolder.setAge(0L);</span>
<span class="nc" id="L444">			advice = true;</span>
		}
		
<span class="nc bnc" id="L447" title="All 2 branches missed.">		if (advice == true)</span>
<span class="nc" id="L448">			return null;</span>
		
<span class="nc bnc" id="L450" title="All 2 branches missed.">		if (newHolder.getRfc().length() != 12) {</span>
<span class="nc" id="L451">		      this.addAdvice(&quot;MCWN01415033&quot;);</span>
<span class="nc" id="L452">		      return null;</span>
		    }
		
		
<span class="nc" id="L456">		return newHolder;</span>
	}
	
	private HolderDTO prepareHolderForUpdate(HolderDTO oldHolder, HolderDTO newHolder) {
<span class="nc" id="L460">		HolderDTO readyHolder = new HolderDTO();</span>
<span class="nc" id="L461">		AccountDTO readyAccount = new AccountDTO();</span>
		
<span class="nc" id="L463">		LOGGER.info(&quot;INFO DEL HOLDER EN BBDD: {}&quot;, oldHolder);</span>
<span class="nc" id="L464">		LOGGER.info(&quot;INFO DEL HOLDER NUEVO: {}&quot;, newHolder);</span>
		
<span class="nc bnc" id="L466" title="All 2 branches missed.">		if(!oldHolder.getName().equals(newHolder.getName())) {</span>
<span class="nc" id="L467">			readyHolder.setName(newHolder.getName());</span>
		}
		
<span class="nc bnc" id="L470" title="All 2 branches missed.">		if(!oldHolder.getLastName().equals(newHolder.getLastName())) {</span>
<span class="nc" id="L471">			readyHolder.setLastName(newHolder.getLastName());</span>
		}
		
<span class="nc bnc" id="L474" title="All 2 branches missed.">		if(!oldHolder.getCurp().equals(newHolder.getCurp())) {</span>
<span class="nc" id="L475">			readyHolder.setCurp(newHolder.getCurp());</span>
		}
		
<span class="nc bnc" id="L478" title="All 2 branches missed.">		if(!oldHolder.getRfc().equals(newHolder.getRfc())) {</span>
<span class="nc" id="L479">			readyHolder.setRfc(newHolder.getRfc());</span>
		}
		
<span class="nc bnc" id="L482" title="All 2 branches missed.">		if(!oldHolder.getAge().equals(newHolder.getAge())) {</span>
<span class="nc" id="L483">			readyHolder.setAge(newHolder.getAge());</span>
		}
		
<span class="nc bnc" id="L486" title="All 2 branches missed.">		if(!oldHolder.getAccount().getAccountCard().equals(newHolder.getAccount().getAccountCard())) {</span>
<span class="nc" id="L487">			readyAccount.setAccountCard(newHolder.getAccount().getAccountCard());</span>
		}
		
<span class="nc bnc" id="L490" title="All 2 branches missed.">		if(!oldHolder.getAccount().getAccountNip().equals(newHolder.getAccount().getAccountNip())) {</span>
<span class="nc" id="L491">			readyAccount.setAccountNip(newHolder.getAccount().getAccountNip());</span>
		}
		
<span class="nc bnc" id="L494" title="All 2 branches missed.">		if(!oldHolder.getAccount().getBalance().equals(newHolder.getAccount().getBalance())) {</span>
<span class="nc" id="L495">			readyAccount.setBalance(newHolder.getAccount().getBalance());</span>
		}
		
<span class="nc bnc" id="L498" title="All 2 branches missed.">		if(!oldHolder.getAccount().getStatus().equals(newHolder.getAccount().getStatus())) {</span>
<span class="nc" id="L499">			readyAccount.setStatus(newHolder.getAccount().getStatus());</span>
		}
		
<span class="nc" id="L502">		readyHolder.setAccount(readyAccount);</span>
		
<span class="nc" id="L504">		LOGGER.info(&quot;ESTADO DEL HOLDER QUE QUEREMOS CAMBIAR: {}&quot;, readyHolder);</span>
		
<span class="nc" id="L506">		return newHolder;</span>
		
	}
	
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>